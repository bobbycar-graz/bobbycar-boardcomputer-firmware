set(headers
    accessors/globalaccessors.h
    accessors/settingsaccessors.h
    accessors/wifiaccessors.h
    actions/bluetoothbeginaction.h
    actions/bluetoothbeginmasteraction.h
    actions/bluetoothconnectbmsaction.h
    actions/bluetoothdisconnectaction.h
    actions/bluetoothendaction.h
    actions/bluetoothflushaction.h
    actions/bmsturnoffchargeaction.h
    actions/bmsturnoffdischargeaction.h
    actions/bmsturnonchargeaction.h
    actions/bmsturnondischargeaction.h
    actions/erasenvsaction.h
    actions/loadsettingsaction.h
    actions/modesettingsaction.h
    actions/multiaction.h
    actions/rebootaction.h
    actions/savesettingsaction.h
    actions/tempomatmodeapplycurrentpeedaction.h
    actions/wifiscanaction.h
    actions/switchprofileaction.h
    actions/updateswapfrontbackaction.h
    bluetoothmode.h
    ble.h
    bletexthelpers.h
    bmsutils.h
    changevaluedisplay_bluetoothmode.h
    changevaluedisplay_controlmode.h
    changevaluedisplay_controltype.h
    changevaluedisplay_larsmmode_mode.h
    changevaluedisplay_unifiedmodelmode.h
    changevaluedisplay_wifi_mode_t.h
    changevaluedisplay_wifi_power_t.h
    cloud.h
    debugcolorhelpers.h
    displays/gameoflifedisplay.h
    displays/graphdisplay.h
    displays/menus/aboutmenu.h
    displays/menus/accesspointwifisettingsmenu.h
    displays/menus/blesettingsmenu.h
    displays/menus/bluetoothsettingsmenu.h
    displays/menus/bmsmenu.h
    displays/menus/buzzermenu.h
    displays/menus/commanddebugmenu.h
    displays/menus/debugmenu.h
    displays/menus/defaultmodesettingsmenu.h
    displays/menus/demosmenu.h
    displays/menus/enablemenu.h
    displays/menus/feedbackdebugmenu.h
    displays/menus/gametrakmodesettingsmenu.h
    displays/menus/genericwifisettingsmenu.h
    displays/menus/graphsmenu.h
    displays/menus/invertmenu.h
    displays/menus/larsmmodesettingsmenu.h
    displays/menus/ledstripmenu.h
    displays/menus/modessettingsmenu.h
    displays/menus/mosfetsmenu.h
    displays/menus/motorstatedebugmenu.h
    displays/menus/presetsmenu.h
    displays/menus/profilesmenu.h
    displays/menus/selectmodemenu.h
    displays/menus/settingsmenu.h
    displays/menus/stationwifisettingsmenu.h
    displays/menus/tempomatmodesettingsmenu.h
    displays/menus/timersmenu.h
    displays/menus/timesettingsmenu.h
    displays/menus/wifisettingsmenu.h
    displays/menus/controllerhardwaresettingsmenu.h
    displays/menus/boardcomputerhardwaresettingsmenu.h
    displays/menus/dynamicdebugmenu.h
    displays/menus/limitssettingsmenu.h
    displays/menus/mainmenu.h
    displays/menus/motorfeedbackdebugmenu.h
    displays/menus/wifiscanmenu.h
    displays/pingpongdisplay.h
    displays/poweroffdisplay.h
    displays/spirodisplay.h
    displays/splitgraphdisplay.h
    displays/starfielddisplay.h
    displays/bmsdisplay.h
    displays/calibratedisplay.h
    displays/dpad5wiredebugdisplay.h
    displays/gametrakcalibratedisplay.h
    displays/garagedisplay.h
    displays/lockscreen.h
    displays/metersdisplay.h
    displays/powersupplydisplay.h
    displays/statusdisplay.h
    displays/updatedisplay.h
    esp_websocket_client.h
    htmltag.h
    icons/alert.h
    icons/bluetooth.h
    icons/bms.h
    icons/buzzer.h
    icons/close.h
    icons/demos.h
    icons/graph.h
    icons/hardware.h
    icons/info.h
    icons/lock.h
    icons/logo.h
    icons/modes.h
    icons/poweroff.h
    icons/presets.h
    icons/reboot.h
    icons/scan.h
    icons/settings.h
    icons/time.h
    icons/update.h
    icons/wifi.h
    ledstrip.h
    modes/defaultmode.h
    modes/gametrakmode.h
    modes/ignoreinputmode.h
    modes/larsmmode.h
    modes/remotecontrolmode.h
    modes/tempomatmode.h
    rotary.h
    screens.h
    types.h
    esptexthelpers.h
    presets.h
    bluetoothtexthelpers.h
    buttons.h
    can.h
    controller.h
    debugtexthelpers.h
    dpad.h
    dpad3wire.h
    dpad5wire.h
    feedbackparser.h
    globals.h
    htmlutils.h
    macros_bobbycar.h
    modeinterface.h
    ota.h
    serialhandler.h
    settings.h
    stringsettings.h
    settingspersister.h
    settingsutils.h
    statistics.h
    statustexthelper.h
    texts.h
    time_bobbycar.h
    unifiedmodelmode.h
    utils.h
    webserver.h
    wifitexthelpers.h
    wifi_bobbycar.h
)

set(sources
    main.cpp
)

set(dependencies
    libsodium freertos nvs_flash esp_http_server esp_https_ota mdns app_update esp_system esp_websocket_client driver
    arduino-esp32 ArduinoJson esp-nimble-cpp FastLED-idf TFT_eSPI
    bobbycar-protocol cpputils cxx-ring-buffer date
    espasynchttpreq espasyncota espchrono espcpputils esp-gui-lib esphttpdutils espwifistack expected fmt
)

idf_component_register(
    SRCS
        ${headers}
        ${sources}
    INCLUDE_DIRS
        .
    REQUIRES
        ${dependencies}
)

target_compile_options(${COMPONENT_TARGET}
    PRIVATE
        -fstack-reuse=all
        -fstack-protector-all
        -Wno-unused-function
        -Wno-deprecated-declarations
        -Wno-missing-field-initializers
        -Wno-parentheses
        ${BOBBYCAR_BUILDFLAGS}
)
